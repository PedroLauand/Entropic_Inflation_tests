#This two lines update the .py files
#import math
import numpy as np
import itertools as itt

from shannon_tests.feasibility_test.desc_entro.desc_entro import desigualdades_basicas, cenario_marginal
from Feas_problem1 import *
from auxiliary_functions import *


##########################################################################################################################
						# DESIGUALDADES BASICAS
##########################################################################################################################
n = 6

(A,vetor_H)=desigualdades_basicas(n)
basicas = A

#np.savetxt('basicas_n=3.txt', np.array(A, dtype=int))

#print(len(A), len(A[0]))
#print(vetor_H)

##########################################################################################################################
						# RESTRICOES LINEARES
##########################################################################################################################

Equalities = Equalities_spiral_inflation(vetor_H)

#print(len(Equalities))

#inequalities = np.vstack([A, Equalities])
#inequalities = A
#inequalities = Equalities
#print(len(inequalities), len(inequalities[0]))

##########################################################################################################################
		# EXTREMAL RESTRICTIONS
##########################################################################################################################
'''
CM = np.array([[0,1,2]]) #Cenario marginal
(M,Ind)=cenario_marginal(CM, n)


#Montando matriz de resticoes do protocolo
newrow=np.zeros(len(vetor_H), dtype='int')

C=np.array([newrow])
j = 0
for k in M:
	C[j][vetor_H.index(k)] = 1
	C = np.vstack([C, newrow])
	j = j + 1
C = np.delete(C, (len(C)-1), axis = 0)
'''
'''
C=np.zeros(len(vetor_H), dtype='int')
C[vetor_H.index((0,))] = 1
C[vetor_H.index((1,))] = 1
C[vetor_H.index((2,))] = 1
#C[vetor_H.index((0,1))] = -1
#C[vetor_H.index((0,2))] = -1
C[vetor_H.index((0,1,2))] = -2

'''

#H = np.zeros(len(vetor_H), dtype='int')
#status = Feasibility_Entropic_vector(inequalities, C, H)

##########################################################################################################################
		# RAYS
##########################################################################################################################
'''
# ---------Pedro-----------------------------
rays = [[1.0, 1.0, 1.0, 1.0, 2.0, 2.0, 2.0],
        [1.0, 1.0, 1.0, 1.5, 1.5, 1.5, 1.5],
        [1.0, 1.0, 2.0, 1.5, 2.5, 2.5, 2.5],
        [1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0],
        [1.0, 0.0, 1.0, 1.0, 2.0, 1.0, 2.0],
        [1.0, 2.0, 3.0, 2.5, 3.5, 4.5, 5.5],
        [2.0, 1.0, 3.0, 2.5, 4.5, 3.5, 5.5],
        [0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
        [0.0, 1.0, 1.0, 1.0, 1.0, 2.0, 2.0],
        [0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0]]
   
# ---------Basicas-----------------------------
rays = [[1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0],
[1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
[1.0, 1.0, 1.0, 2.0, 2.0, 2.0, 2.0],
[1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0],
[0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
[0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0],
[0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0],
[1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0]]

# ---------basicas + ineq -----------------------------
rays = [[1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0],
[1.5, 1.0, 1.5, 2.0, 2.5, 2.0, 3.0],
[1.5, 1.5, 1.0, 2.5, 2.0, 2.0, 3.0],
[1.0, 1.5, 1.5, 2.0, 2.0, 2.5, 3.0],
[1.0, 1.0, 1.0, 2.0, 2.0, 2.0, 2.0],
[1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0],
[0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
[1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0],
[0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0],
[0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0]]

rays = [[1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0],
[1.0, 1.5, 1.5, 2.0, 2.0, 2.5, 3.0],
[1.5, 1.0, 1.5, 2.0, 2.5, 2.0, 3.0],
[1.5, 1.5, 1.0, 2.5, 2.0, 2.0, 3.0],
[1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0],
[1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0],
[1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0],
[-0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0],
[-0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
[0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0]]
'''


rays = [
        [1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0],
        [1.0, 1.5, 1.5, 2.0, 2.0, 2.5, 3.0],
        [1.5, 1.0, 1.5, 2.0, 2.5, 2.0, 3.0],
        [1.5, 1.5, 1.0, 2.5, 2.0, 2.0, 3.0],
        [1.0, 1.0, 1.0, 2.0, 2.0, 2.0, 2.0],
        [1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0],
        [1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0],
        [0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
        [0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0],
        [0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0],
    ]

C = rays_indexes(vetor_H)

for ray in rays:
    status = Feasibility_Entropic_vector(basicas, Equalities, C, np.array(ray))
    print(status)

#This two lines update the .py files
#%load_ext autoreload
#%autoreload 2
##########################################################################################################################
		# SOLVING
##########################################################################################################################
'''
PG = p222()
#PG = pW()
pU = (1/8)*np.ones((2,2,2), dtype='float')
#pU = pD()

alpha_i = 0.0
alpha_f = 1.0
delta = (alpha_f - alpha_i)/1000

#for alpha in np.arange(0.001,0.0019,(0.0019-0.001)/20):
#for alpha in np.arange(0.00,0.005,0.005/40):

for alpha in np.arange(alpha_i,alpha_f,delta):
    #alpha = 0.00362
    #alpha = 0.00125
    #alpha = 1.0
    pabc = alpha*PG + (1-alpha)*pU
    H = vector_H(M, pabc)
    status = Feasibility_Entropic_vector(inequalities, C, H)
    if(status == 3):
        print(round(alpha,5), status)
        break
    #break
print(alpha)
'''